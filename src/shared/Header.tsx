import React, { useState } from 'react';
import { View, Text, StyleSheet, TouchableOpacity } from 'react-native';
import { useTheme } from './theme';
import SegmentedControl from './SegmentedControl';
import Svg, { Path } from 'react-native-svg';

const Header = ({ title, showSegmentedControl = true, onBackPress }: { 
  title?: string,
  showSegmentedControl?: boolean,
  onBackPress?: () => void
}) => {
  const theme = useTheme();
  const [activeSegment, setActiveSegment] = useState(0);
  
  const segments = ['Explore', 'My tasks', 'Insights'];

  return (
    <View style={styles.container}>
      {title && (
        <View style={styles.titleWrapper}>
          <View style={styles.left}>
            {onBackPress && (
              <TouchableOpacity 
                style={styles.backButton} 
                onPress={onBackPress}
                activeOpacity={0.7}
              >
                <Svg width="20" height="20" viewBox="0 0 20 20" fill="none">
                  <Path 
                    d="M12.9422 15.8079C13.0003 15.866 13.0463 15.9349 13.0777 16.0108C13.1092 16.0867 13.1254 16.168 13.1254 16.2501C13.1254 16.3322 13.1092 16.4135 13.0777 16.4894C13.0463 16.5653 13.0003 16.6342 12.9422 16.6923C12.8841 16.7504 12.8152 16.7964 12.7393 16.8278C12.6634 16.8593 12.5821 16.8755 12.5 16.8755C12.4179 16.8755 12.3366 16.8593 12.2607 16.8278C12.1848 16.7964 12.1159 16.7504 12.0578 16.6923L5.80782 10.4423C5.74971 10.3842 5.70361 10.3153 5.67215 10.2394C5.6407 10.1636 5.62451 10.0822 5.62451 10.0001C5.62451 9.91797 5.6407 9.83664 5.67215 9.76077C5.70361 9.68489 5.74971 9.61596 5.80782 9.55792L12.0578 3.30792C12.1751 3.19064 12.3342 3.12476 12.5 3.12476C12.6659 3.12476 12.8249 3.19064 12.9422 3.30792C13.0595 3.42519 13.1254 3.58425 13.1254 3.7501C13.1254 3.91596 13.0595 4.07502 12.9422 4.19229L7.1336 10.0001L12.9422 15.8079Z" 
                    fill={theme.textPrimary}
                  />
                </Svg>
              </TouchableOpacity>
            )}
            <Text style={[styles.title, { color: theme.textPrimary }]}>{title}</Text>
          </View>
          <View style={styles.right}>
            <TouchableOpacity style={styles.iconButton}>
              <Svg width="24" height="24" viewBox="0 0 24 24" fill="none">
                <Path d="M20.25 6.1875H5.25C5.00136 6.1875 4.7629 6.08873 4.58709 5.91291C4.41127 5.7371 4.3125 5.49864 4.3125 5.25C4.3125 5.00136 4.41127 4.7629 4.58709 4.58709C4.7629 4.41127 5.00136 4.3125 5.25 4.3125H18C18.1492 4.3125 18.2923 4.25324 18.3977 4.14775C18.5032 4.04226 18.5625 3.89918 18.5625 3.75C18.5625 3.60082 18.5032 3.45774 18.3977 3.35225C18.2923 3.24676 18.1492 3.1875 18 3.1875H5.25C4.70299 3.1875 4.17839 3.4048 3.79159 3.79159C3.4048 4.17839 3.1875 4.70299 3.1875 5.25V17.25C3.1875 17.797 3.4048 18.3216 3.79159 18.7084C4.17839 19.0952 4.70299 19.3125 5.25 19.3125H20.25C20.5981 19.3125 20.9319 19.1742 21.1781 18.9281C21.4242 18.6819 21.5625 18.3481 21.5625 18V7.5C21.5625 7.1519 21.4242 6.81806 21.1781 6.57192C20.9319 6.32578 20.5981 6.1875 20.25 6.1875ZM20.4375 18C20.4375 18.0497 20.4177 18.0974 20.3826 18.1326C20.3474 18.1677 20.2997 18.1875 20.25 18.1875H5.25C5.00136 18.1875 4.7629 18.0887 4.58709 17.9129C4.41127 17.7371 4.3125 17.4986 4.3125 17.25V7.08656C4.60255 7.23544 4.92397 7.3129 5.25 7.3125H20.25C20.2997 7.3125 20.3474 7.33225 20.3826 7.36742C20.4177 7.40258 20.4375 7.45027 20.4375 7.5V18ZM17.8125 12.375C17.8125 12.5604 17.7575 12.7417 17.6545 12.8958C17.5515 13.05 17.4051 13.1702 17.2338 13.2411C17.0625 13.3121 16.874 13.3307 16.6921 13.2945C16.5102 13.2583 16.3432 13.169 16.2121 13.0379C16.081 12.9068 15.9917 12.7398 15.9555 12.5579C15.9193 12.376 15.9379 12.1875 16.0089 12.0162C16.0798 11.8449 16.2 11.6985 16.3542 11.5955C16.5083 11.4925 16.6896 11.4375 16.875 11.4375C17.1236 11.4375 17.3621 11.5363 17.5379 11.7121C17.7137 11.8879 17.8125 12.1264 17.8125 12.375Z" fill={theme.textPrimary}/>
              </Svg>
            </TouchableOpacity>
            <TouchableOpacity style={styles.iconButton}>
              <Svg width="24" height="24" viewBox="0 0 24 24" fill="none">
                <Path d="M5.81239 9.99375V3.75C5.81239 3.60082 5.75313 3.45774 5.64764 3.35225C5.54215 3.24676 5.39907 3.1875 5.24989 3.1875C5.10071 3.1875 4.95763 3.24676 4.85214 3.35225C4.74665 3.45774 4.68739 3.60082 4.68739 3.75V9.99375C4.0516 10.1229 3.48 10.4678 3.06943 10.9701C2.65886 11.4724 2.43457 12.1012 2.43457 12.75C2.43457 13.3988 2.65886 14.0276 3.06943 14.5299C3.48 15.0322 4.0516 15.3771 4.68739 15.5062V20.25C4.68739 20.3992 4.74665 20.5423 4.85214 20.6477C4.95763 20.7532 5.10071 20.8125 5.24989 20.8125C5.39907 20.8125 5.54215 20.7532 5.64764 20.6477C5.75313 20.5423 5.81239 20.3992 5.81239 20.25V15.5062C6.44818 15.3771 7.01978 15.0322 7.43035 14.5299C7.84092 14.0276 8.06521 13.3988 8.06521 12.75C8.06521 12.1012 7.84092 11.4724 7.43035 10.9701C7.01978 10.4678 6.44818 10.1229 5.81239 9.99375ZM5.24989 14.4375C4.91613 14.4375 4.58987 14.3385 4.31237 14.1531C4.03486 13.9677 3.81857 13.7041 3.69084 13.3958C3.56312 13.0874 3.5297 12.7481 3.59481 12.4208C3.65993 12.0934 3.82065 11.7928 4.05665 11.5568C4.29265 11.3208 4.59333 11.16 4.92067 11.0949C5.24802 11.0298 5.58732 11.0632 5.89567 11.191C6.20402 11.3187 6.46757 11.535 6.65299 11.8125C6.83842 12.09 6.93739 12.4162 6.93739 12.75C6.93739 13.1976 6.7596 13.6268 6.44313 13.9432C6.12666 14.2597 5.69744 14.4375 5.24989 14.4375ZM12.5624 5.49375V3.75C12.5624 3.60082 12.5031 3.45774 12.3976 3.35225C12.2921 3.24676 12.1491 3.1875 11.9999 3.1875C11.8507 3.1875 11.7076 3.24676 11.6021 3.35225C11.4967 3.45774 11.4374 3.60082 11.4374 3.75V5.49375C10.8016 5.62285 10.23 5.96779 9.81943 6.4701C9.40886 6.97242 9.18457 7.60124 9.18457 8.25C9.18457 8.89876 9.40886 9.52758 9.81943 10.0299C10.23 10.5322 10.8016 10.8771 11.4374 11.0063V20.25C11.4374 20.3992 11.4967 20.5423 11.6021 20.6477C11.7076 20.7532 11.8507 20.8125 11.9999 20.8125C12.1491 20.8125 12.2921 20.7532 12.3976 20.6477C12.5031 20.5423 12.5624 20.3992 12.5624 20.25V11.0063C13.1982 10.8771 13.7698 10.5322 14.1804 10.0299C14.5909 9.52758 14.8152 8.89876 14.8152 8.25C14.8152 7.60124 14.5909 6.97242 14.1804 6.4701C13.7698 5.96779 13.1982 5.62285 12.5624 5.49375ZM11.9999 9.9375C11.6661 9.9375 11.3399 9.83853 11.0624 9.65311C10.7849 9.46768 10.5686 9.20413 10.4408 8.89578C10.3131 8.58743 10.2797 8.24813 10.3448 7.92078C10.4099 7.59344 10.5706 7.29276 10.8066 7.05676C11.0426 6.82076 11.3433 6.66004 11.6707 6.59492C11.998 6.52981 12.3373 6.56323 12.6457 6.69095C12.954 6.81868 13.2176 7.03497 13.403 7.31247C13.5884 7.58998 13.6874 7.91624 13.6874 8.25C13.6874 8.69755 13.5096 9.12677 13.1931 9.44324C12.8767 9.75971 12.4474 9.9375 11.9999 9.9375ZM21.5624 15.75C21.5616 15.1019 21.3374 14.4738 20.9276 13.9717C20.5177 13.4696 19.9473 13.1242 19.3124 12.9938V3.75C19.3124 3.60082 19.2531 3.45774 19.1476 3.35225C19.0421 3.24676 18.8991 3.1875 18.7499 3.1875C18.6007 3.1875 18.4576 3.24676 18.3521 3.35225C18.2467 3.45774 18.1874 3.60082 18.1874 3.75V12.9938C17.5516 13.1229 16.98 13.4678 16.5694 13.9701C16.1589 14.4724 15.9346 15.1012 15.9346 15.75C15.9346 16.3988 16.1589 17.0276 16.5694 17.5299C16.98 18.0322 17.5516 18.3771 18.1874 18.5062V20.25C18.1874 20.3992 18.2467 20.5423 18.3521 20.6477C18.4576 20.7532 18.6007 20.8125 18.7499 20.8125C18.8991 20.8125 19.0421 20.7532 19.1476 20.6477C19.2531 20.5423 19.3124 20.3992 19.3124 20.25V18.5062C19.9473 18.3758 20.5177 18.0304 20.9276 17.5283C21.3374 17.0262 21.5616 16.3981 21.5624 15.75ZM18.7499 17.4375C18.4161 17.4375 18.0899 17.3385 17.8124 17.1531C17.5349 16.9677 17.3186 16.7041 17.1908 16.3958C17.0631 16.0874 17.0297 15.7481 17.0948 15.4208C17.1599 15.0934 17.3206 14.7928 17.5566 14.5568C17.7926 14.3208 18.0933 14.16 18.4207 14.0949C18.748 14.0298 19.0873 14.0632 19.3957 14.191C19.704 14.3187 19.9676 14.535 20.153 14.8125C20.3384 15.09 20.4374 15.4162 20.4374 15.75C20.4374 16.1976 20.2596 16.6268 19.9431 16.9432C19.6267 17.2597 19.1974 17.4375 18.7499 17.4375Z" fill={theme.textPrimary}/>
              </Svg>
            </TouchableOpacity>
          </View>
        </View>
      )}
      
      {showSegmentedControl && (
        <View style={styles.segmentedControlWrapper}>
          <SegmentedControl 
            segments={segments}
            activeIndex={activeSegment}
            onSegmentChange={setActiveSegment}
          />
        </View>
      )}
    </View>
  );
};

const styles = StyleSheet.create({
  container: {
    paddingHorizontal: 16,
    paddingTop: 16,
    paddingBottom: 12,
  },
  titleWrapper: {
    flexDirection: 'row',
    alignItems: 'center',
    justifyContent: 'space-between',
    marginBottom: 16,
  },
  left: {
    flexDirection: 'row',
    alignItems: 'center',
    gap: 12,
  },
  backButton: {
    padding: 4,
    marginRight: 4,
  },
  title: {
    fontSize: 22,
    fontWeight: '700',
  },
  right: {
    flexDirection: 'row',
    alignItems: 'center',
    gap: 12,
  },
  iconButton: {
    width: 32,
    height: 32,
    borderRadius: 8,
    alignItems: 'center',
    justifyContent: 'center',
  },
  segmentedControlWrapper: {
    alignItems: 'center',
  },
});

export default Header;


